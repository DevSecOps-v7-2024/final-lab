# Acá va el nombre (Integracion Continua)
name: CI

# Acá se declaran los eventos
on:

# Si se ejecuta el push cada vez
 push:
 workflow_dispatch:

# Acá es donde se declaran los trabajos y los pasos (jobs --< steps)
jobs:
  
 build:   
  runs-on: ubuntu-latest  
  steps:  
   - uses: actions/checkout@v3   
   - name: Inicio
     run: |
       echo "Jelou Jelou"

#Conexion con SonarCloud 
 SonarCloud:
  runs-on: ubuntu-latest
  needs: build  
  steps:
  - name: Checkout repository
    uses: actions/checkout@v3
 
  - name: Setup Node.js
    uses: actions/checkout@v3
    with:
      node-version: '14'
 
  - name: Install dependencies
    run: npm install
 
  - name: Run SonarCloud analysis
    uses: sonarsource/sonarcloud-github-action@master
    
    #Tokens de Seguridad
    env:
      GITHUB_TOKEN: ${{ secrets.TOKENSEGURIDAD }}
      SONAR_TOKEN: ${{ secrets.TOKENSEGURIDAD }}

#Integracion SCA
 DependencyCheck:
  runs-on: ubuntu-latest
  needs: build
  steps:
  - name: Dependency Check
    uses: dependency-check/Dependency-Check_Action@1.1.0
    with:    
      project: 'final-lab'
      path: '.'
      format: 'HTML' 
     
  - name: Upload Test results
    uses: actions/upload-artifact@master
    with:
      name: Depcheck report
      path: ${{github.workspace}}/reports
   
  #Login de Docker
  - name: Docker Login
    uses: docker/login-action@v3.0.0
    with:
      username: ${{ secrets.DOCKER_USER }}
      password: ${{ secrets.DOCKER_PASSWORD }}

